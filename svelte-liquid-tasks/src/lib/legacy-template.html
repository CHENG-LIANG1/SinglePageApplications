<div class="background-mesh"></div>

    <div class="outside-ornaments" aria-hidden="true"></div>

    <div class="outside-tagline" id="outsideTagline"></div>
    <div class="outside-badge" id="outsideBadge" aria-hidden="true">
        <div class="outside-badge-title" id="outsideBadgeTitle"></div>
        <div class="outside-badge-sub" id="outsideBadgeSub"></div>
    </div>
    <div class="outside-strip" id="outsideStrip" aria-hidden="true"></div>
    <div class="outside-status" id="outsideStatus" aria-hidden="true"><span class="dot"></span><span id="outsideStatusText"></span></div>

    <div id="globalTooltip"></div>

    <div class="app-card" id="appCard">
        <div class="modal-overlay" id="modalOverlay" onclick="window.closeOverlays()"></div>

        <div class="detail-modal" id="themeModal">
            <div style="padding: 24px 30px; border-bottom: 1px solid var(--glass-border); display:flex; justify-content:space-between; align-items:center; flex-shrink: 0;">
                <h3 id="themeModalTitle" style="margin:0; font-size:18px; color:var(--text-primary); font-weight:600;">Appearance</h3>
                <button class="detail-icon-btn" onclick="window.closeThemePicker()"><i data-lucide="x"></i></button>
            </div>
            <div class="theme-grid" id="themeGrid"></div>
        </div>

        <div class="detail-modal" id="calendarModal">
             <div style="padding: 24px 30px; border-bottom: 1px solid var(--glass-border); display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <button class="detail-icon-btn" onclick="window.changeFullCalendarYear(-1)"><i data-lucide="chevron-left"></i></button>
                    <h3 id="fullCalTitle" style="margin:0; font-size:18px; color:var(--text-primary); font-weight:700;">2026 Details</h3>
                    <button class="detail-icon-btn" onclick="window.changeFullCalendarYear(1)"><i data-lucide="chevron-right"></i></button>
                </div>
                <button class="detail-icon-btn" onclick="window.closeCalendarModal()"><i data-lucide="x"></i></button>
            </div>
            <div class="detail-content">
                <div id="yearScrollContainer" class="year-scroll-container">
                    </div>
            </div>
        </div>

        <div class="detail-modal" id="trashModal" style="max-width: 600px;">
             <div style="padding: 24px 30px; border-bottom: 1px solid var(--glass-border); display:flex; justify-content:space-between; align-items:center;">
                <h3 id="trashModalTitle" style="margin:0; font-size:18px; color:var(--text-primary); font-weight:600;">Trash Bin</h3>
                <button class="detail-icon-btn" onclick="window.closeTrash()"><i data-lucide="x"></i></button>
            </div>
            <div class="detail-content" id="trashList" style="padding: 20px; max-height: 30vh; overflow-y: auto;"></div>
            <div class="detail-footer" style="justify-content: flex-end;">
                 <button class="detail-icon-btn" style="color:var(--accent-red); width:auto; padding:0 12px; gap:6px;" onclick="window.emptyTrash()">
                    <i data-lucide="trash-2"></i> Empty Trash
                 </button>
            </div>
        </div>

        <div class="detail-modal" id="detailModal">
            <div class="detail-content" id="detailContent"></div>
            <div class="detail-footer">
                <div class="detail-meta" id="detailMeta"></div>
                <div class="detail-actions" id="detailActions"></div>
            </div>
        </div>

        <div class="view-container" id="viewContainer">
            <div class="header">
                <div class="header-left">
                    <div class="header-subtitle" id="dateDisplay">DATE</div>
                    <h1 id="appTitle" contenteditable="true" spellcheck="false" onblur="window.saveTitle(this.innerText)">Tasks</h1>
                </div>
                <div class="header-controls">
                    <div class="search-bar">
                        <i data-lucide="search" class="search-icon"></i>
                        <input type="text" class="search-input" id="searchInput" placeholder="Search" autocomplete="off">
                    </div>
                    <button class="header-btn" id="themeBtn" onclick="window.openThemePicker()" title="Theme">
                        <i data-lucide="palette"></i>
                    </button>
                    <button class="header-btn" onclick="window.openTrash()" title="Trash">
                        <i data-lucide="trash"></i>
                    </button>
                    <button class="header-btn" id="toggleArchived" onclick="window.toggleShowArchived()" title="Archive">
                        <i data-lucide="archive"></i>
                    </button>
                    <button class="header-btn" id="btnActivity" onclick="window.toggleActivityView()" title="Activity">
                        <i data-lucide="flame"></i>
                    </button>
                </div>
            </div>

            <div class="scroll-content" id="todoScrollArea">
                
                <div id="activityView" class="activity-view">
                    <div class="act-header">
                        <div class="act-title" id="actTitle">Activity Dashboard</div>
                        <div style="display:flex; gap:10px; align-items:center;">
                            <div class="act-control-item highlight" id="totalCompletedDisplay">0 Completed</div>
                            <div class="act-control-item" style="gap:10px; padding:0 6px;">
                                <button onclick="window.changeHeatmapYear(-1)" style="background:none; border:none; color:inherit; cursor:pointer; display:flex;"><i data-lucide="chevron-left" style="width:14px;"></i></button>
                                <span id="heatmapYear" style="font-variant-numeric: tabular-nums;">2026</span>
                                <button onclick="window.changeHeatmapYear(1)" style="background:none; border:none; color:inherit; cursor:pointer; display:flex;"><i data-lucide="chevron-right" style="width:14px;"></i></button>
                            </div>
                            <button class="act-control-item" onclick="window.openCalendarModal()" title="Full Year Calendar" style="cursor:pointer;">
                                <i data-lucide="calendar" style="width:16px;"></i>
                            </button>
                        </div>
                    </div>

                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card">
                            <div class="stat-label">This Week</div>
                            <div class="stat-value" id="statWeek">0</div>
                            <div class="stat-sub" id="statWeekDiff">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">This Month</div>
                            <div class="stat-value" id="statMonth">0</div>
                            <div class="stat-sub" id="statMonthDiff">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">This Year</div>
                            <div class="stat-value" id="statYear">0</div>
                            <div class="stat-sub" id="statYearDiff">--</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Completion Rate</div>
                            <div class="stat-value" id="statRate">0%</div>
                            <div class="stat-sub">Lifetime</div>
                        </div>
                    </div>

                    <div class="heatmap-container">
                        <div class="heatmap-wrapper">
                            <div class="heatmap-grid" id="heatmapGrid"></div>
                            <div class="heatmap-months">
                                 <span class="hm-month-label">Jan</span><span class="hm-month-label">Feb</span><span class="hm-month-label">Mar</span><span class="hm-month-label">Apr</span><span class="hm-month-label">May</span><span class="hm-month-label">Jun</span><span class="hm-month-label">Jul</span><span class="hm-month-label">Aug</span><span class="hm-month-label">Sep</span><span class="hm-month-label">Oct</span><span class="hm-month-label">Nov</span><span class="hm-month-label">Dec</span>
                            </div>
                        </div>
                    </div>

                    <div class="adv-charts-grid">
                        <div class="chart-container" style="min-height: 320px; height: 320px;">
                            <div class="chart-header">
                                <span class="chart-title">Monthly Trend</span>
                                <button class="chart-toggle" onclick="window.toggleChartType()">
                                <i data-lucide="bar-chart-2" id="chartIcon"></i>
                                <span id="chartLabel">Switch to Bar</span>
                            </button>
                            </div>
                            <div id="activityChart" style="width:100%; height:250px;"></div>
                        </div>
                        
                        <div class="chart-container" style="min-height: 320px; height: 320px;">
                            <div class="chart-header">
                                <span class="chart-title">Day of Week</span>
                                <button class="chart-toggle" onclick="window.toggleDowChartType()">
                                    <i data-lucide="activity" id="dowChartIcon"></i>
                                    <span id="dowChartLabel">Switch to Line</span>
                                </button>
                            </div>
                            <div id="dowChart" style="width:100%; height:250px;"></div>
                        </div>

                        <div class="chart-container" style="min-height: 320px; height: 320px;">
                            <div class="chart-header">
                                <span class="chart-title">Productivity Hours</span>
                                <button class="chart-toggle" onclick="window.toggleTodChartType()">
                                    <i data-lucide="bar-chart-2" id="todChartIcon"></i>
                                    <span id="todChartLabel">Switch to Bar</span>
                                </button>
                            </div>
                            <div id="todChart" style="width:100%; height:250px;"></div>
                        </div>

                        <div class="chart-container" style="min-height: 320px; height: 320px;">
                            <div class="chart-header"><span class="chart-title">Task Distribution</span></div>
                            <div id="pieChart" style="width:100%; height:250px;"></div>
                        </div>
                    </div>
                </div>

                <div id="listView">
                    <div id="pinnedContainer" class="section-container">
                        <div class="section-inner">
                            <div class="section-title" id="pinnedTitle"><i data-lucide="pin" style="width:12px;"></i> Pinned</div>
                            <div id="pinnedList"></div>
                        </div>
                    </div>

                    <div id="todoList"></div>
                    <div class="empty-state" id="emptyTodo">
                        <div class="empty-icon-wrapper"><i data-lucide="check-circle-2"></i></div>
                        <p id="emptyTodoText">All caught up.</p>
                    </div>
                </div>

            </div>

            <div class="floating-input-container" id="inputContainer">
                <div class="glass-popup" id="taskDatePicker">
                    <div class="dp-header">
                        <button class="dp-nav" onclick="window.changeTaskMonth(-1)"><i data-lucide="chevron-left" style="width:16px;"></i></button>
                        <span style="font-weight:600; font-size:15px;" id="dpTitle">Month</span>
                        <button class="dp-nav" onclick="window.changeTaskMonth(1)"><i data-lucide="chevron-right" style="width:16px;"></i></button>
                    </div>
                    <div class="dp-day-names">
                        <span class="dp-day-name">Su</span><span class="dp-day-name">Mo</span><span class="dp-day-name">Tu</span><span class="dp-day-name">We</span><span class="dp-day-name">Th</span><span class="dp-day-name">Fr</span><span class="dp-day-name">Sa</span>
                    </div>
                    <div class="dp-grid" id="dpGrid"></div>
                </div>

                <div class="glass-popup" id="subtaskDatePicker">
                    <div class="dp-header">
                        <button class="dp-nav" onclick="window.changeSubtaskMonth(-1)"><i data-lucide="chevron-left" style="width:16px;"></i></button>
                        <span style="font-weight:600; font-size:15px;" id="subDpTitle">Month</span>
                        <button class="dp-nav" onclick="window.changeSubtaskMonth(1)"><i data-lucide="chevron-right" style="width:16px;"></i></button>
                    </div>
                    <div class="dp-day-names">
                        <span class="dp-day-name">Su</span><span class="dp-day-name">Mo</span><span class="dp-day-name">Tu</span><span class="dp-day-name">We</span><span class="dp-day-name">Th</span><span class="dp-day-name">Fr</span><span class="dp-day-name">Sa</span>
                    </div>
                    <div class="dp-grid" id="subDpGrid"></div>
                </div>

                <div class="input-capsule">
                    <div class="input-left-controls">
                        <div class="meta-trigger" id="taskDateTrigger" onclick="window.toggleTaskDatePicker()">
                            <i data-lucide="calendar"></i>
                            <span id="taskDateDisplay">Due</span>
                        </div>
                        <div class="meta-trigger" id="taskRecurTrigger" onclick="window.cycleRecurrence()">
                            <i data-lucide="rotate-cw"></i>
                            <span id="taskRecurDisplay">Repeat</span>
                        </div>
                        <button class="expand-btn" id="expandBtn" onclick="window.toggleExpand()">
                            <i data-lucide="maximize-2"></i>
                        </button>
                    </div>

                    <textarea class="text-input" id="todoInput" placeholder="New Task..." rows="1"></textarea>
                    
                    <div class="recurrence-options">
                        <button class="recur-btn active" id="recurNone" onclick="window.setRecurrence('none')">No Repeat</button>
                        <button class="recur-btn" id="recurDaily" onclick="window.setRecurrence('daily')"><i data-lucide="rotate-cw"></i> Daily</button>
                        <button class="recur-btn" id="recurWork" onclick="window.setRecurrence('workdays')"><i data-lucide="briefcase"></i> Workdays</button>
                        <button class="recur-btn" id="recurWeekly" onclick="window.setRecurrence('weekly')"><i data-lucide="calendar-days"></i> Weekly</button>
                        <button class="recur-btn" id="recurMonthly" onclick="window.setRecurrence('monthly')"><i data-lucide="calendar"></i> Monthly</button>
                        <button class="recur-btn" id="recurYearly" onclick="window.setRecurrence('yearly')"><i data-lucide="calendar-clock"></i> Yearly</button>
                    </div>

                    <div class="markdown-toolbar">
                        <button class="md-tool-btn" onclick="window.insertMarkdown('**', '**')"><i data-lucide="bold" style="width:14px;"></i></button>
                        <button class="md-tool-btn" onclick="window.insertMarkdown('*', '*')"><i data-lucide="italic" style="width:14px;"></i></button>
                        <button class="md-tool-btn" onclick="window.insertMarkdown('\n- ', '')"><i data-lucide="list" style="width:14px;"></i></button>
                        <button class="md-tool-btn" onclick="window.insertMarkdown('## ', '')"><i data-lucide="heading" style="width:14px;"></i></button>
                        <button class="md-tool-btn" onclick="window.insertMarkdown('`', '`')"><i data-lucide="code" style="width:14px;"></i></button>
                        <button class="md-tool-btn" onclick="window.insertMarkdown('\n> ', '')"><i data-lucide="quote" style="width:14px;"></i></button>
                    </div>

                    <div class="subtasks-editor" id="subtasksEditor">
                        <div class="subtasks-head">
                            <div class="subtasks-title">Subtasks</div>
                            <button class="subtask-add-btn" id="subtaskAddBtn" onclick="window.addDraftSubtask()">Add</button>
                        </div>
                        <div class="subtasks-hint" id="subtasksHint"></div>
                        <div class="subtasks-list" id="subtasksList"></div>
                    </div>

                    <button class="action-btn" id="actionBtn" onclick="window.addTodo()">
                        <i data-lucide="arrow-up" style="width:24px;" id="actionIcon"></i>
                    </button>
                </div>
            </div>

        </div>

    </div>
